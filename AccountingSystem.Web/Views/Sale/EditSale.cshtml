
@{
    ViewData["Title"] = "EditSale";
}

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.9/angular.min.js"></script>

<h3 class="text-center alert-primary" style="margin-top:-10px">Edit Sale</h3>

<div ng-app="myApp">
    <div ng-controller="myController">
        <div class="col-sm-12">
            <div class="row">
                <div class="col-sm-6">
                    <div class="form-group row">
                        <label class="col-sm-3 col-form-label">Company</label>
                        <div class="col-sm-9">
                            <input class="form-control form-control-sm" placeholder="Search Company Here" autocomplete="off" ng-model="company" ng-keyup="searchCompany(company)">
                            <select class="form-control form-control-sm" size="10" ng-model="comList" style="position:absolute;z-index:999;width: 200px; overflow:auto ;background: white none repeat scroll 0% 0%;" ng-show="companyList.length > 0">
                                <option ng-repeat="company in companyList" value="{{company.id}}" ng-click="selectCompany(company)">{{company.name}}</option>
                            </select>
                        </div>
                    </div>
                    <div>Select a company</div>
                    <div class="mt-2" style="height: 250px; overflow-y: auto;border:2px solid gray">
                        <table class="table table-bordered table-hover table-sm" style="white-space:nowrap;">                            
                                <tr>
                                    
                                </tr>
                        </table>
                    </div>
                    <div class="row mt-2">
                        <div class="col-sm-3">
                            <button class="btn btn-success btn-sm">Regular List</button>
                        </div> 
                        <div class="col-sm-3">
                            <button class="btn btn-danger btn-sm">Deleted List</button>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6 mt-3">
                    <div class="px-3 py-4" style="border:2px solid gray">
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">Sales Price</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control form-control-sm" ng-model="salesPrice">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">VAT Amount</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control form-control-sm" ng-model="vatAmount">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-2 col-form-label mt-3">Duration</label>
                            <div class="col-sm-4">
                                <label>From Date</label>
                                <input type="date" class="form-control form-control-sm" ng-model="fromDate">
                            </div>
                            <div class="col-sm-4">
                                <label>To Date</label>
                                <input type="date" class="form-control form-control-sm" ng-model="toDate">
                            </div>
                            <div class="col-sm-2">
                                <label>Duration</label>
                                <input type="number" class="form-control form-control-sm" ng-model="duration">
                            </div>
                        </div>
                        <div class="form-group row mt-2">
                            <label class="col-sm-3 col-form-label">Billing Contact</label>
                            <div class="col-sm-9">
                                <select class="form-control form-control-sm" ng-model="billingContact">
                                    <option value="0" selected>Select</option>
                                    <option ng-repeat="o in getBillingPersonData" value="{{o.id}}">{{o.name}}</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">Ref No.</label>
                            <div class="col-sm-9">
                                <input type="number" class="form-control form-control-sm" ng-model="refNo">
                            </div>
                        </div>
                        <div class="form-group row">
                            <label class="col-sm-3 col-form-label">Sales Person</label>
                            <div class="col-sm-9">
                                <select class="form-control form-control-sm" ng-model="salesPerson">
                                    <option value="0" selected>select</option>
                                    <option ng-repeat="o in salesPersons" value="{{o.salesPersonID}}">{{o.salesPersonName}}</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                </div>

                <div class="col-sm-12">
                    <div class="pull-left text-left" style="margin-top:20px;" ng-show="isVisible">
                        Show
                        <select id="page" ng-model="itemsPerPage">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="40">40</option>
                            <option value="50" selected>50</option>
                            <option value="60">60</option>
                            <option value="80">80</option>
                            <option value="100">100</option>
                            <option value="500">500</option>
                            <option value="1000">1000</option>
                            <option value="3000">3000</option>
                            <option value="5000">5000</option>
                            <option value="10000">10000</option>
                            <option value="10000000">All</option>
                        </select>
                        entries per page. (Total:{{totalItems}} data)

                        @* section paging *@
                        <nav aria-label="...">
                            <ul class="pagination">
                                <li class="page-item" ng-class="{ disabled: currentPage === 1 }">
                                    <a class="page-link" href="#" ng-click="setCurrentPage(currentPage - 1)" aria-label="Previous">
                                        <span aria-hidden="true">&laquo;</span>
                                    </a>
                                </li>

                                <!-- The ng-repeat code you provided -->
                                <li class="page-item" ng-repeat="page in getPages()" ng-class="{ active: currentPage === page }">
                                    <a class="page-link" href="#" ng-click="setCurrentPage(page)">{{ page }}</a>
                                </li>

                                <li class="page-item" ng-class="{ disabled: currentPage === totalPages }">
                                    <a class="page-link" href="#" ng-click="setCurrentPage(currentPage + 1)" aria-label="Next">
                                        <span aria-hidden="true">&raquo;</span>
                                    </a>
                                </li>
                            </ul>
                        </nav>
                        @* section paging end *@
                    </div>
                </div>
                <table class="table table-bordered table-striped table-sm">
                    <thead>
                        <tr>
                            <th>SNo</th>
                            <th>Product name</th>
                            <th>From</th>
                            <th>To</th>
                            <th>Duration</th>
                            <th>Price(Tk)</th>
                            <th>Due(Tk)</th>
                            <th>Posted</th>
                            <th>VAT(Tk)</th>
                            <th>Invoice No</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="o in salesData">
                            <td>{{$index+1}}</td>
                            <td>{{o.sbName}}</td>
                            <td>{{o.fromDate}}</td>
                            <td>{{o.toDate}}</td>
                            <td>{{o.duration}}</td>
                            <td>{{o.amount}}</td>
                            <td>{{o.accReceivale}}</td>
                            <td>{{o.posted}}</td>
                            <td>{{o.tax}}</td>
                            <td>{{o.invoiceNo}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    var app = angular.module('myApp', []);
    app.controller('myController', function ($scope, $http) {
        angular.element(document).ready(function () {
            $scope.getSalesPerson();
            $scope.billingContact = "0";
            $scope.isVisible = false;

            $scope.itemsPerPage = '20';
            $scope.maxPageLength = 5;
            $scope.currentPage = 1;
            $scope.totalItems = 0;
        });

        $scope.companyList = [];
        $scope.searchCompany = function (startingKey) {
            if (startingKey && startingKey.length > 1) {
                let Url = '';
                if (window.location.hostname == 'localhost')
                    Url = '/Company/GetCompanyListByKey';
                else
                    Url = '/AccountingNew/Company/GetCompanyListByKey';

                $http.get(Url, { params: { startingKey: startingKey } })
                    .then(function (response) {
                        $scope.companyList = response.data;
                    }, function (error) {
                        console.error(error);
                    })
            } else {
                $scope.companyList = [];
            }
        };

        $scope.selectedCompany = null;
        $scope.selectCompany = function (company) {
            $scope.selectedCompany = company;
            $scope.company = company.name;
            $scope.companyList = [];

            $scope.getBillingPerson($scope.comList);
            $scope.getSales($scope.currentPage, $scope.itemsPerPage, $scope.comList, 0);
        }

        $scope.getBillingPerson = function (cId) {
            let Url = '';
            if (window.location.hostname == 'localhost')
                Url = '/Company/GetContactPersonByCompanyId';
            else
                Url = '/AccountingNew/Company/GetContactPersonByCompanyId';

            $http.get(Url, { params: { companyId: cId } })
                .then(function (response) {
                    debugger
                    $scope.getBillingPersonData = response.data;                   
                }, function (error) {
                    console.error(error);
                })
        }

        $scope.getSalesPerson = function () {
            let Url = '';
            if (window.location.hostname == 'localhost')
                Url = '/Sale/GetSalesPersonsByProductID';
            else
                Url = '/AccountingNew/Sale/GetSalesPersonsByProductID';
            $http.get(Url, { params: { productID: 2 } })
                .then(function (response) {
                    $scope.salesPersons = response.data;
                    $scope.salesPerson = "0";
                }, function (error) {
                    console.error(error);
                });
        };

        $scope.getSales = function (pageNo, pageSize, cId, tno) {

            let Url = '';
            if (window.location.hostname == 'localhost')
                Url = '/Sale/GetSales';
            else
                Url = '/AccountingNew/Sale/GetSales';

            $http.get(Url, { params: { pageNo: pageNo, pageSize: pageSize, cId: cId, tno:tno} })
                .then(function (response) {
                    debugger
                    $scope.salesData = response.data.sales;
                    $scope.isVisible = true;
                })
                .catch(function (error) {
                    console.log(error);
                })
        }
    });
</script>